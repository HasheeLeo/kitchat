{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"isAsync":false}},{"name":"@babel/runtime/helpers/classCallCheck","data":{"isAsync":false}},{"name":"@babel/runtime/helpers/createClass","data":{"isAsync":false}},{"name":"uuid/v4","data":{"isAsync":false}},{"name":"./AccountApi","data":{"isAsync":false}},{"name":"../constants","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = _$$_REQUIRE(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.default = void 0;\n\n  var _classCallCheck2 = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[1], \"@babel/runtime/helpers/classCallCheck\"));\n\n  var _createClass2 = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[2], \"@babel/runtime/helpers/createClass\"));\n\n  var _v = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[3], \"uuid/v4\"));\n\n  var _AccountApi = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[4], \"./AccountApi\"));\n\n  var _constants = _$$_REQUIRE(_dependencyMap[5], \"../constants\");\n\n  var Session = function () {\n    function Session() {\n      var _this = this;\n\n      (0, _classCallCheck2.default)(this, Session);\n\n      var userId = _AccountApi.default.getUserId();\n\n      this.ws = new WebSocket(\"ws://\" + _constants.SERVER_IP + \"/private-message?\" + userId);\n\n      this.ws.onopen = function (e) {\n        return console.log('yay');\n      };\n\n      this.ws.onerror = function (e) {\n        return console.log(e);\n      };\n\n      this.ws.onmessage = function (e) {\n        return _this.onReceiveData(e.data);\n      };\n\n      this.subscribers = {};\n      this.onReceiveData = this.onReceiveData.bind(this);\n      this.sendData = this.sendData.bind(this);\n      this.subscribe = this.subscribe.bind(this);\n    }\n\n    (0, _createClass2.default)(Session, [{\n      key: \"destroy\",\n      value: function destroy() {\n        this.ws.close();\n      }\n    }, {\n      key: \"onReceiveData\",\n      value: function onReceiveData(data) {\n        if (typeof data !== 'string') throw 'non-string data from server';\n\n        if (this.subscribers[_constants.Event.message]) {\n          var eventSubscribers = this.subscribers[_constants.Event.message];\n          eventSubscribers.forEach(function (callbackObject) {\n            return callbackObject.callback(data);\n          });\n        }\n      }\n    }, {\n      key: \"sendData\",\n      value: function sendData(data) {\n        this.ws.send(data);\n      }\n    }, {\n      key: \"subscribe\",\n      value: function subscribe(event, callback) {\n        var _this2 = this;\n\n        var id = (0, _v.default)();\n        if (!this.subscribers[event]) this.subscribers[event] = [{\n          id: id,\n          callback: callback\n        }];else this.subscribers[event].push({\n          id: id,\n          callback: callback\n        });\n        return function () {\n          _this2.subscribers[event] = _this2.subscribers[event].filter(function (callback) {\n            return callback.id !== id;\n          });\n        };\n      }\n    }]);\n    return Session;\n  }();\n\n  var _default = Session;\n  exports.default = _default;\n});","lineCount":94,"map":[[13,0,3,0],[15,0,5,0],[17,0,6,0],[19,6,11,6,"Session"],[19,13],[20,0,19,2],[20,23,19,16],[21,0,19,16],[23,0,19,16],[25,0,20,4],[25,10,20,10,"userId"],[25,16,20,16],[25,19,20,19,"AccountApi"],[25,39,20,30,"getUserId"],[25,48,20,19],[25,50,20,4],[27,0,21,4],[27,11,21,9,"ws"],[27,13,21,4],[27,16,21,14],[27,20,21,18,"WebSocket"],[27,29,21,14],[27,40,21,36,"SERVER_IP"],[27,60,21,14],[27,85,21,65,"userId"],[27,91,21,14],[27,92,21,4],[29,0,22,4],[29,11,22,9,"ws"],[29,13,22,4],[29,14,22,12,"onopen"],[29,20,22,4],[29,23,22,21],[29,33,22,22,"e"],[29,34,22,21],[30,0,22,21],[30,15,22,28,"console"],[30,22,22,35],[30,23,22,36,"log"],[30,26,22,28],[30,27,22,40],[30,32,22,28],[30,33,22,21],[31,0,22,21],[31,7,22,4],[33,0,23,4],[33,11,23,9,"ws"],[33,13,23,4],[33,14,23,12,"onerror"],[33,21,23,4],[33,24,23,22],[33,34,23,23,"e"],[33,35,23,22],[34,0,23,22],[34,15,23,29,"console"],[34,22,23,36],[34,23,23,37,"log"],[34,26,23,29],[34,27,23,41,"e"],[34,28,23,29],[34,29,23,22],[35,0,23,22],[35,7,23,4],[37,0,24,4],[37,11,24,9,"ws"],[37,13,24,4],[37,14,24,12,"onmessage"],[37,23,24,4],[37,26,24,24],[37,36,24,25,"e"],[37,37,24,24],[38,0,24,24],[38,15,24,31],[38,20,24,35],[38,21,24,36,"onReceiveData"],[38,34,24,31],[38,35,24,50,"e"],[38,36,24,51],[38,37,24,52,"data"],[38,41,24,31],[38,42,24,24],[39,0,24,24],[39,7,24,4],[41,0,25,4],[41,11,25,9,"subscribers"],[41,22,25,4],[41,25,25,23],[41,27,25,4],[42,0,27,4],[42,11,27,9,"onReceiveData"],[42,24,27,4],[42,27,27,25],[42,32,27,30,"onReceiveData"],[42,45,27,25],[42,46,27,44,"bind"],[42,50,27,25],[42,51,27,49],[42,55,27,25],[42,56,27,4],[43,0,28,4],[43,11,28,9,"sendData"],[43,19,28,4],[43,22,28,20],[43,27,28,25,"sendData"],[43,35,28,20],[43,36,28,34,"bind"],[43,40,28,20],[43,41,28,39],[43,45,28,20],[43,46,28,4],[44,0,29,4],[44,11,29,9,"subscribe"],[44,20,29,4],[44,23,29,21],[44,28,29,26,"subscribe"],[44,37,29,21],[44,38,29,36,"bind"],[44,42,29,21],[44,43,29,41],[44,47,29,21],[44,48,29,4],[45,0,30,3],[49,32,32,12],[50,0,33,4],[50,13,33,9,"ws"],[50,15,33,4],[50,16,33,12,"close"],[50,21,33,4],[51,0,34,3],[54,36,36,16,"data"],[54,40],[54,42,36,29],[55,0,37,4],[55,12,37,8],[55,19,37,15,"data"],[55,23,37,8],[55,28,37,24],[55,36,37,4],[55,38,38,6],[55,44,38,12],[55,73,38,6],[57,0,40,4],[57,12,40,8],[57,17,40,13,"subscribers"],[57,28,40,8],[57,29,40,25,"Event"],[57,46,40,31,"message"],[57,53,40,8],[57,54,40,4],[57,56,40,41],[58,0,41,6],[58,14,41,12,"eventSubscribers"],[58,30,41,28],[58,33,41,31],[58,38,41,36,"subscribers"],[58,49,41,31],[58,50,41,48,"Event"],[58,67,41,54,"message"],[58,74,41,31],[58,75,41,6],[59,0,42,6,"eventSubscribers"],[59,10,42,6,"eventSubscribers"],[59,26,42,22],[59,27,42,23,"forEach"],[59,34,42,6],[59,35,42,31],[59,45,42,31,"callbackObject"],[59,59,42,45],[60,0,42,45],[60,19,42,49,"callbackObject"],[60,33,42,63],[60,34,42,64,"callback"],[60,42,42,49],[60,43,42,73,"data"],[60,47,42,49],[60,48,42,45],[61,0,42,45],[61,11,42,6],[62,0,43,5],[63,0,44,3],[66,31,46,11,"data"],[66,35],[66,37,46,25],[67,0,47,4],[67,13,47,9,"ws"],[67,15,47,4],[67,16,47,12,"send"],[67,20,47,4],[67,21,47,17,"data"],[67,25,47,4],[68,0,48,3],[71,32,51,12,"event"],[71,37],[71,39,51,26,"callback"],[71,47],[71,49,51,51],[72,0,51,51],[74,0,52,4],[74,12,52,10,"id"],[74,14,52,12],[74,17,52,15],[74,34,52,4],[75,0,53,4],[75,12,53,8],[75,13,53,9],[75,18,53,14,"subscribers"],[75,29,53,9],[75,30,53,26,"event"],[75,35,53,9],[75,36,53,4],[75,38,54,6],[75,43,54,11,"subscribers"],[75,54,54,6],[75,55,54,23,"event"],[75,60,54,6],[75,64,54,32],[75,65,54,33],[76,0,54,34,"id"],[76,10,54,34,"id"],[76,12,54,36],[76,14,54,38,"id"],[76,16,54,33],[77,0,54,42,"callback"],[77,10,54,42,"callback"],[77,18,54,50],[77,20,54,52,"callback"],[78,0,54,33],[78,9,54,32],[78,10,54,6],[78,11,53,4],[78,16,56,6],[78,21,56,11,"subscribers"],[78,32,56,6],[78,33,56,23,"event"],[78,38,56,6],[78,40,56,30,"push"],[78,44,56,6],[78,45,56,35],[79,0,56,36,"id"],[79,10,56,36,"id"],[79,12,56,38],[79,14,56,40,"id"],[79,16,56,35],[80,0,56,44,"callback"],[80,10,56,44,"callback"],[80,18,56,52],[80,20,56,54,"callback"],[81,0,56,35],[81,9,56,6],[82,0,58,4],[82,15,58,11],[82,27,58,17],[83,0,59,6],[83,10,59,6],[83,16,59,10],[83,17,59,11,"subscribers"],[83,28,59,6],[83,29,59,23,"event"],[83,34,59,6],[83,38,60,8],[83,44,60,12],[83,45,60,13,"subscribers"],[83,56,60,8],[83,57,60,25,"event"],[83,62,60,8],[83,64,60,32,"filter"],[83,70,60,8],[83,71,60,39],[83,81,60,39,"callback"],[83,89,60,47],[84,0,60,47],[84,19,60,51,"callback"],[84,27,60,59],[84,28,60,60,"id"],[84,30,60,51],[84,35,60,67,"id"],[84,37,60,47],[85,0,60,47],[85,11,60,8],[85,12,59,6],[86,0,62,5],[86,9,58,4],[87,0,63,3],[92,17,66,15,"Session"],[92,24]],"functionMap":{"names":["<global>","Session","constructor","ws.onopen","ws.onerror","ws.onmessage","destroy","onReceiveData","eventSubscribers.forEach$argument_0","sendData","subscribe","<anonymous>","subscribers.event.filter$argument_0"],"mappings":"AAA;ACU;ECQ;qBCG,yBD;sBEC,qBF;wBGC,iCH;GDM;EKE;GLE;EME;+BCM,+CD;GNE;EQE;GRE;ESG;WCO;uCCE,8BD;KDE;GTC;CDC"}},"type":"js/module"}]}